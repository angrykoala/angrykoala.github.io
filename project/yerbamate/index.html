<!DOCTYPE HTML><html><head><meta charset="utf-8"><title>Yerbamate â€º Angry Koala</title><meta name="author" content="angrykoala"><meta name="description" content="A blog for programmers and koalas"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:title" content="Yerbamate"><meta property="og:site_name" content="Angry Koala"><meta property="og:image" content=""><link href="/favicon.png" rel="icon"><link rel="alternate" href="/atom.xml" title="Angry Koala" type="application/atom+xml"><link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"><!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--></head></html><body><header id="header"><div class="meta inner"><h1><a href="/">Angry Koala</a></h1><h2><a href="/">A Koala With a Computer</a></h2><nav id="main-nav"><ul><li><a href="/archives">Archives</a></li><li><a href="https://github.com/angrykoala" rel="external nofollow noopener noreferrer" target="_blank">GitHub</a></li><li><a href="/projects">My Projects</a></li><li><a href="/about">About</a></li></ul><div class="clearfix"></div></nav></div><div class="clearfix"></div></header><div id="content" class="inner"><div id="main-col" class="alignleft"><div id="wrapper"><article class="post"><div class="post-content"><header><h1 class="title">Yerbamate</h1><time datetime="2016-10-23T10:27:10.000Z">2016-10-23</time></header><div class="entry"><blockquote><p>The js testing library for command-line interfaces.</p></blockquote><p>Sometimes, you want to add automated tests for your node-based CLI. With <em>Yerbamate</em> now you can simply test your programs directly within your favorite testing framework like <a href="https://mochajs.org/" rel="external nofollow noopener noreferrer" target="_blank"><em>mocha</em></a> without the mess of creating complex <em>gulp</em> pipelines or adding extra bash scripts. Just with old good Javascript.</p><a id="more"></a><h2><span id="usage">Usage</span></h2><p><em>Yerbamate</em> allows you to easily test commands from your favorite Javascript testing framework.</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">yerbamate.run(<span class="string">"cat my_file.md"</span>, <span class="literal">null</span>, &#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">code, out, errs</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(yerbamate.isErrorCode(code)) <span class="built_in">console</span>.log(<span class="string">"Error: "</span> + errs[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">console</span>.log(<span class="string">"Success - "</span> + out);    </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><em>Yerbamate</em> also provides easy access to you package.json defined scripts and commands, so you can test your module easily.</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> yerbamate=<span class="built_in">require</span>(<span class="string">'yerbamate'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pkg=yerbamate.loadPackage(<span class="built_in">module</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Test the package.json start script</span></span><br><span class="line">yerbamate.run(pkg.start, pkg.dir, &#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">code, out, errs</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(yerbamate.isErrorCode(code)) <span class="built_in">console</span>.log(<span class="string">"Process exited with error code"</span>);</span><br><span class="line">    <span class="keyword">if</span>(errs.length&gt;<span class="number">0</span>) <span class="built_in">console</span>.log(<span class="string">"Errors in process:"</span> + errs.length);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Output: "</span> + out[<span class="number">0</span>]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3><span id="api">API</span></h3><ul><li><p><code>loadPackage(module)</code> Will load your package.json module data. The returned object will contain the path to the <code>package.json</code> file, <code>main</code> and <code>start</code> script as well as <code>bin</code> and <code>scripts</code> objects from package.json</p></li><li><p><code>run(command, dir, options, done)</code> Will run the given command as a child_process in the given path. The options allows you to set callbacks for <code>stdout</code> and <code>stderr</code> outputs, as well as extra space-separated arguments with <code>args</code>. The callback will return the execution code of the process, an array with all the console outputs and an array with all the error outputs.</p></li><li><p><code>isErrorCode(code)</code> Will return true if the given process code is an error code, false otherwise</p></li></ul></div><footer><div class="categories"><a href="/categories/project/">Project</a></div><div class="addthis addthis_toolbox addthis_default_style"><a class="addthis_button_tweet"></a> <a class="addthis_button_google_plusone" g:plusone:size="medium"></a> <a class="addthis_counter addthis_pill_style"></a></div><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script><div class="clearfix"></div></footer></div></article><section id="comment"></section></div></div><aside id="sidebar" class="alignright"><div class="widget tag"><h3 class="title">Recent Posts</h3><ul class="entry"><li><a href="/project/gaucho/">Gaucho</a></li><li><a href="/project/yerbamate/">Yerbamate</a></li><li><a href="/project/yamp/">Yamp</a></li><li><a href="/tutorial/node-wizardry/">Node Wizadry</a></li><li><a href="/project/chuckscript/">ChuckScript</a></li></ul></div><div class="widget tag"><h3 class="title">Categories</h3><ul class="entry"><li><a href="/categories/general/">General</a><small>1</small></li><li><a href="/categories/project/">Project</a><small>4</small></li><li><a href="/categories/tutorial/">Tutorial</a><small>1</small></li></ul></div></aside><div class="clearfix"></div></div><footer id="footer" class="inner"><div class="alignleft">&copy; 2018 angrykoala</div><div class="clearfix"></div></footer><script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script></body>